{"ts":1348046060441,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"\r\n/**\r\n * Module dependencies.\r\n */\r\n\r\nvar express = require('express')\r\n  , routes = require('./routes')  \r\n  , http = require('http')\r\n  , path = require('path');\r\n\r\nvar app = express();\r\n\r\napp.configure(function(){\r\n  app.set('port', process.env.PORT || 3000);\r\n  app.set('views', __dirname + '/views');\r\n  app.set('view engine', 'jade');\r\n  app.use(express.favicon());\r\n  app.use(express.logger('dev'));\r\n  app.use(express.bodyParser());\r\n  app.use(express.methodOverride());\r\n  app.use(app.router);\r\n  app.use(express.static(path.join(__dirname, 'public')));\r\n});\r\n\r\napp.configure('development', function(){\r\n  app.use(express.errorHandler());\r\n});\r\n\r\napp.get('/', routes.index);\r\n\r\n/* chat */\r\napp.get('/chat', function(req, res){\r\n\tres.render('chat');\r\n});\r\n\r\napp.get('/chat/chat_room', function(req, res){\t\r\n\tres.render('chat/chat_room',{room_name:req.param('room_name')});\r\n});\r\n/* chat */\r\n\r\nvar server = http.createServer(app).listen(app.get('port'), function(){\r\n  console.log(\"Express server listening on port \" + app.get('port'));\r\n});\r\n\r\nvar io = require('socket.io').listen(server);\r\n\r\nio.sockets.on('connection', function(socket){\r\n\t/* chat */\r\n\tsocket.on('send_msg', function(data){\r\n\t\tvar room_name = data.room_name;\r\n\t\tvar name = data.name;\r\n\t\tvar date = data.date;\r\n\t\tvar msg = data.msg;\r\n\t\t\r\n\t\tvar param = {msg:msg,name:name,date:date}\r\n\t\t\r\n\t\tio.sockets.in(room_name).emit('recv_msg',param);\t\t\r\n\t});\r\n\t\r\n\tsocket.on('join_room', function(data){\t\t\r\n\t\tvar room_name = data.room_name;\t\t\r\n\t\tsocket.join(room_name);\t\t\r\n\t});\r\n\t\r\n\tsocket.on('room_list', function(){\r\n\t\tvar room_list = [];\t\t\r\n\t\tconsole.log(io.sockets.manager.rooms);\t\t\r\n\t\tfor(var item in io.sockets.manager.rooms){\t\t\t\r\n\t\t\tif(item) room_list.push(item.replace('/',''));\r\n\t\t}\r\n\t\tsocket.emit('room_list', room_list);\r\n\t});\r\n\t/* chat */\r\n});\r\n\r\n\r\n\r\n"]],"start1":0,"start2":0,"length1":0,"length2":1825}]],"length":1825}
{"contributors":[],"silentsave":false,"ts":1348046102346,"patch":[[{"diffs":[[0," chat */\r\n\r\n"],[1,"/* location */\r\napp.get('/tracker', function(req, res){\r\n    res.render('location/tracker');\r\n});\r\n\r\napp.get('/observer', function(req, res){\r\n\tres.render('location/observer');\r\n});\r\n\r\napp.get('/showdata', function(req, res){\r\n\t//client.query('select * from locations where name = ?',[req.query.name], function(err, data){\t\r\n\t\r\n\tvar data = room_list[req.query.name]['list'];\r\n\tvar cnt = Object.keys(room_list[req.query.name]['list']).length;\r\n\t\t\r\n\tres.writeHead(200, {'Content-Type':'application/json'});\r\n\tres.end(JSON.stringify(data));\t\t\r\n\t//});\r\n});\r\n/* location */\r\n\r\n"],[0,"var server ="]],"start1":890,"start2":890,"length1":24,"length2":596},{"diffs":[[0,"hat */\r\n"],[1,"    \r\n    /* location */\r\n    socket.on('join', function(data){\t\t\r\n\t\tsocket.join(data);\r\n\t});\r\n\t\r\n\tsocket.on('location', function(data){\t\t\t\t\r\n\t\t\r\n\t\tif(!room_list[data.name]) {\r\n\t\t\troom_list[data.name] = new Object();\r\n\t\t\troom_list[data.name]['list'] = new Object();\t\t\t\r\n\t\t}\r\n\r\n\t\tvar cnt = Object.keys(room_list[data.name]['list']).length ? Object.keys(room_list[data.name]['list']).length : 0;\r\n\t\t\r\n\t\tif(cnt == 3) {\r\n\t\t\tdata.latitude = 38;\r\n\t\t\tdata.longitude = 128;\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\troom_list[data.name]['list'][cnt] = new Object();\r\n\t\troom_list[data.name]['list'][cnt]['latitude'] = data.latitude;\r\n\t\troom_list[data.name]['list'][cnt]['longitude'] = data.longitude;\t\t\r\n\t\t\r\n\t\t\r\n\t\tconsole.log('######################################################################');\r\n\t\tio.sockets.in(data.name).emit('receive', {latitude:data.latitude,longitude:data.longitude});\r\n\t});\r\n\t/* location */\r\n"],[0,"});\r\n\r\n\r"]],"start1":2378,"start2":2378,"length1":16,"length2":901}]],"length":3282,"saved":false}
